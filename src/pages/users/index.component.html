<panel-breadcrumb></panel-breadcrumb>
<d-table [data]="data">
  <ng-template dTableTemplate="caption">
    <d-button icon="far fa-plus" (click)="showDialog(formTpl, {title: 'افزودن کاربر جدید'})" *auth="'User'">
      افزودن کاربر جدید
    </d-button>
  </ng-template>
  <ng-template dTableTemplate="header,footer">
    <tr>
      <th>#</th>
      <th>نام</th>
      <th>نام کاربری</th>
      <th>شماره موبایل</th>
      <th>ایمیل</th>
      <th class="text-align-center" width="10">ورود دو مرحله ای</th>
      <th class="text-align-center" width="10">نیاز به تغییر رمز</th>
      <th class="text-align-center" width="10">فعال</th>
      <th class="text-align-center" width="10">مدیر</th>
      <th class="text-align-center" width="10">عملیات</th>
    </tr>
  </ng-template>
  <ng-template dTableTemplate="body" let-item let-index="index">
    <tr>
      <td title="ردیف">{{ index }}</td>
      <td title="نام">{{ item.name }}</td>
      <td title="نام کاربری">{{ item.username }}</td>
      <td title="شماره موبایل">{{ item.cellphone }}</td>
      <td title="ایمیل">{{ item.email }}</td>
      <td title="ورود دو مرحله ای">
        <div class="flex-center">
          <span [ngClass]="(item.isTwoFactorAuthenticationEnable ? 'color-success' : 'color-danger')">
            {{ item.isTwoFactorAuthenticationEnable ? 'بله' : 'خیر' }}
          </span>
        </div>
      </td>
      <td title="نیاز به تغییر رمز">
        <div class="flex-center">
          <span [ngClass]="(item.needResetPassword ? 'color-success' : 'color-danger')">
            {{ item.needResetPassword ? 'بله' : 'خیر' }}
          </span>
        </div>
      </td>
      <td title="فعال">
        <div class="flex-center">
          <span [ngClass]="(item.isActive ? 'color-success' : 'color-danger')">{{ item.isActive ? 'بله' : 'خیر' }}</span>
        </div>
      </td>
      <td title="مدیر">
        <i *ngIf="item.isAdmin" class="far fa-crown color-warning"></i>
      </td>
      <td class="operation-cell">
        <div class="w-100 flex-center flex-gap-3">
          <ng-container *ngFor="let option of userOptions">
            <d-button size="sm" *auth="option.accesses" mode="text" [color]="option.color" [icon]="option.icon"
                      (click)="showDialogByComponent(option.component, {user:item}, option.dialog)"></d-button>
          </ng-container>
          <d-button size="sm" *auth="['Access-Read','Privilege-Read']" mode="text" color="secondary" icon="far fa-shield-halved"
                    (click)="showDialog(accessTpl, {title: 'دسترسی کاربر ' + item.name, context: item})">دسترسی ها</d-button>
          <d-button size="sm" *auth="'User'" mode="text" color="warning" icon="far fa-pen-to-square"
                    (click)="showDialog(formTpl, {title: 'ویرایش کاربر ' + item.name, context: item})">ویرایش</d-button>
          <d-button size="sm" *auth="'User'" mode="text" color="danger" icon="far fa-trash-can" (click)="remove(item)">حذف</d-button>
        </div>
      </td>
    </tr>
  </ng-template>
  <ng-template dTableTemplate="detail">
    <div>
      <label>شماره موبایل</label>
      <span></span>
    </div>
  </ng-template>
</d-table>

<ng-template #formTpl let-dialog let-item="context">
  <app-form [model]="item" (onComplete)="dialog.close()"></app-form>
</ng-template>

<ng-template #accessTpl let-dialog let-item="context">
  <app-access [model]="item" (onComplete)="dialog.close()"></app-access>
</ng-template>
